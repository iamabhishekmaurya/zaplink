version: "3.9"

services:
    # ============================================================
    # üó∫Ô∏è Eureka Server (Service Registry)
    # ============================================================
    zaplink-service-registry:
        build:
            context: ./services/zaplink-service-registry
            dockerfile: Dockerfile
        container_name: zaplink-service-registry
        image: zaplink-service-registry:latest
        ports:
            - "8761:8761"
        environment:
            - EUREKA_CLIENT_REGISTER_WITH_EUREKA=false
            - EUREKA_CLIENT_FETCH_REGISTRY=false
            - EUREKA_SERVER_ENABLE_SELF_PRESERVATION=false
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # üö™ API Gateway
    # ============================================================
    api-gateway-service:
        build:
            context: ./services/api-gateway-service
            dockerfile: Dockerfile
        container_name: api-gateway-service
        image: api-gateway-service:latest
        depends_on:
            - zaplink-service-registry
        ports:
            - "8090:8090"
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # ‚öôÔ∏è Manager Service
    # ============================================================
    zaplink-manager-service:
        build:
            context: ./services/zaplink-manager-service
            dockerfile: Dockerfile
        container_name: zaplink-manager-service
        image: zaplink-manager-service:latest
        ports:
            - "8083:8083"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # üì¶ Producer Service
    # ============================================================
    zaplink-producer-service:
        build:
            context: ./services/zaplink-producer-service
            dockerfile: Dockerfile
        container_name: zaplink-producer-service
        image: zaplink-producer-service:latest
        ports:
            - "8081:8081"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # üì• Consumer Service
    # ============================================================
    zaplink-consumer-service:
        build:
            context: ./services/zaplink-consumer-service
            dockerfile: Dockerfile
        container_name: zaplink-consumer-service
        image: zaplink-consumer-service:latest
        ports:
            - "8082:8082"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

# ============================================================
# üåê Shared Network
# ============================================================
networks:
    zaplink-net:
        driver: bridge
