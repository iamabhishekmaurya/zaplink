version: "3.9"

services:
    # ============================================================
    # üó∫Ô∏è Eureka Server (Service Registry)
    # ============================================================
    zaplink-service-registry:
        build:
            context: ./services/zaplink-service-registry
            dockerfile: Dockerfile
        container_name: zaplink-service-registry
        image: zaplink-service-registry:latest
        ports:
            - "8761:8761"
        environment:
            - EUREKA_CLIENT_REGISTER_WITH_EUREKA=false
            - EUREKA_CLIENT_FETCH_REGISTRY=false
            - EUREKA_SERVER_ENABLE_SELF_PRESERVATION=false
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # üö™ API Gateway
    # ============================================================
    api-gateway-service:
        build:
            context: ./services/api-gateway-service
            dockerfile: Dockerfile
        container_name: api-gateway-service
        image: api-gateway-service:latest
        depends_on:
            - zaplink-service-registry
        ports:
            - "8090:8090"
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # ‚öôÔ∏è Manager Service
    # ============================================================
    zaplink-manager-service:
        build:
            context: ./services/zaplink-manager-service
            dockerfile: Dockerfile
        container_name: zaplink-manager-service
        image: zaplink-manager-service:latest
        ports:
            - "8083:8083"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # üì¶ core Service
    # ============================================================
    zaplink-core-service:
        build:
            context: ./services/zaplink-core-service
            dockerfile: Dockerfile
        container_name: zaplink-core-service
        image: zaplink-core-service:latest
        ports:
            - "8081:8081"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # üì• processor Service
    # ============================================================
    zaplink-processor-service:
        build:
            context: ./services/zaplink-processor-service
            dockerfile: Dockerfile
        container_name: zaplink-processor-service
        image: zaplink-processor-service:latest
        ports:
            - "8082:8082"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

    # ============================================================
    # üì• auth Service
    # ============================================================
    zaplink-auth-service:
        build:
            context: ./services/zaplink-auth-service
            dockerfile: Dockerfile
        container_name: zaplink-auth-service
        image: zaplink-auth-service:latest
        ports:
            - "8084:8084"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net
    # ============================================================
    # üì• Notification Service
    # ============================================================
    zaplink-notification-service:
        build:
            context: ./services/zaplink-notification-service
            dockerfile: Dockerfile
        container_name: zaplink-notification-service
        image: zaplink-notification-service:latest
        ports:
            - "8085:8085"
        depends_on:
            - zaplink-service-registry
        environment:
            - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://zaplink-service-registry:8761/eureka/
            - SPRING_PROFILES_ACTIVE=docker
        networks:
            - zaplink-net

# ============================================================
# üåê Shared Network
# ============================================================
networks:
    zaplink-net:
        driver: bridge
