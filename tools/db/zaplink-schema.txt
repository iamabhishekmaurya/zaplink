STEP 1:

CREATE TABLE url_mappings (
    id BIGSERIAL PRIMARY KEY,
    short_url_key VARCHAR(255) UNIQUE NOT NULL,
    original_url TEXT NOT NULL,
    short_url VARCHAR(500) NOT NULL,
    trace_id VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP,
    click_count BIGINT DEFAULT 0,
    status VARCHAR(20) DEFAULT 'ACTIVE'
);

STEP 2:

CREATE INDEX idx_short_url_key ON url_mappings(short_url_key);
CREATE INDEX idx_created_at ON url_mappings(created_at);
CREATE INDEX idx_status ON url_mappings(status);

STEP 3:

CREATE TABLE url_analytics (
    id BIGSERIAL PRIMARY KEY,
    short_url_key VARCHAR(255) NOT NULL,
    ip_address INET,
    user_agent TEXT,
    referrer VARCHAR(500),
    country VARCHAR(100),
    city VARCHAR(100),
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (short_url_key) REFERENCES url_mappings(short_url_key)
);

STEP 4:

CREATE INDEX idx_short_url_key_analytics ON url_analytics(short_url_key);
CREATE INDEX idx_accessed_at ON url_analytics(accessed_at);

STEP 5:

CREATE TABLE url_statistics (
    id BIGSERIAL PRIMARY KEY,
    short_url_key VARCHAR(255) UNIQUE NOT NULL,
    total_clicks BIGINT DEFAULT 0,
    today_clicks BIGINT DEFAULT 0,
    last_accessed TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (short_url_key) REFERENCES url_mappings(short_url_key)
);

STEP 6:

CREATE INDEX idx_total_clicks ON url_statistics(total_clicks);
CREATE INDEX idx_last_accessed ON url_statistics(last_accessed);
